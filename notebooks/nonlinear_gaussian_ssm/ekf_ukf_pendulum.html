
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Tracking a 1d pendulum using Extended / Unscented Kalman filter/ smoother</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Online learning for an MLP using extended Kalman filtering" href="ekf_mlp.html" />
    <link rel="prev" title="Tracking a spiraling object using the extended / unscented Kalman filter" href="ekf_ukf_spiral.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.gif" class="logo" alt="logo">
  
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  HMMs
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../hmm/casino_hmm_inference.html">
   Casino HMM: Inference (state estimation)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../hmm/casino_hmm_learning.html">
   Casino HMM: Learning (parameter estimation)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../hmm/gaussian_hmm.html">
   Gaussian HMM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../hmm/autoregressive_hmm.html">
   Autoregressive (AR) HMM Demo
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Linear Gaussian SSMs
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_gaussian_ssm/kf_tracking.html">
   Tracking an object using the Kalman filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_gaussian_ssm/kf_linreg.html">
   Online linear regression using Kalman filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_gaussian_ssm/lgssm_parallel_inference.html">
   Parallel filtering and smoothing in an LG-SSM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_gaussian_ssm/lgssm_learning.html">
   MAP parameter estimation for an LG-SSM using EM and SGD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_gaussian_ssm/lgssm_hmc.html">
   Bayesian parameter estimation for an LG-SSM using HMC
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Nonlinear Gaussian SSMs
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="ekf_ukf_spiral.html">
   Tracking a spiraling object using the extended / unscented Kalman filter
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Tracking a 1d pendulum using Extended / Unscented Kalman filter/ smoother
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ekf_mlp.html">
   Online learning for an MLP using extended Kalman filtering
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Generalized Gaussian SSMs
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../generalized_gaussian_ssm/cmgf_logistic_regression_demo.html">
   Online Logistic Regression using conditional moments Gaussian filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../generalized_gaussian_ssm/cmgf_mlp_classification_demo.html">
   Online learning of an MLP Classifier using conditional moments Gaussian filter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../generalized_gaussian_ssm/cmgf_poisson_demo.html">
   Fitting an LDS with Poisson Likelihood using conditional moments Gaussian filter
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  API Documentation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html">
   State Space Model (Base class)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html#hidden-markov-model">
   Hidden Markov Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html#linear-gaussian-ssm">
   Linear Gaussian SSM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html#nonlinear-gaussian-gssm">
   Nonlinear Gaussian GSSM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html#generalized-gaussian-gssm">
   Generalized Gaussian GSSM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../api.html#utilities">
   Utilities
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/probml/dynamax"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/probml/dynamax/main?urlpath=tree/docs/notebooks/nonlinear_gaussian_ssm/ekf_ukf_pendulum.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/probml/dynamax/blob/main/docs/notebooks/nonlinear_gaussian_ssm/ekf_ukf_pendulum.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sample-data-and-plot-it">
   Sample data and plot it
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extended-kalman-filter-smoother">
   Extended Kalman Filter  / smoother
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unscented-kalman-filter-smoother">
   Unscented Kalman Filter  / smoother
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="tracking-a-1d-pendulum-using-extended-unscented-kalman-filter-smoother">
<h1>Tracking a 1d pendulum using Extended / Unscented Kalman filter/ smoother<a class="headerlink" href="#tracking-a-1d-pendulum-using-extended-unscented-kalman-filter-smoother" title="Permalink to this heading">¶</a></h1>
<p>This notebook demonstrates a simple pendulum tracking example.
The example is taken from p45 of
<em>Bayesian Filtering and Smoothing</em> (S. Särkkä, 2013).
This code is based on the  <a class="reference external" href="https://github.com/petergchang/sarkka-jax">sarkka-jax</a> repo.</p>
<p>The physics of the problem is shown below, where <span class="math notranslate nohighlight">\(\alpha\)</span> is the angle relative to vertical,
and <span class="math notranslate nohighlight">\(w(t)\)</span> is a white noise process added to the angular velocity (a random acceleration term).</p>
<p><img alt="Pendulum" src="https://github.com/probml/dynamax/blob/main/docs/figures/pendulum.png?raw=true" /></p>
<p>This gives rise to the following differential equation:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{d^2 \alpha}{d t^2}
= -g \sin(\alpha) + w(t)
\end{align*}\]</div>
<p>We can write this as a nonlinear SSM by defining the state to be
<span class="math notranslate nohighlight">\(z_1(t) = \alpha(t)\)</span> and <span class="math notranslate nohighlight">\(z_2(t) = d\alpha(t)/dt\)</span>.
Thus</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{d z}{dt}
= \begin{pmatrix} z_2 \\ -g \sin(z_1) \end{pmatrix}
+ \begin{pmatrix} 0 \\ 1 \end{pmatrix} w(t)
\end{align*}\]</div>
<p>If we discretize this step size <span class="math notranslate nohighlight">\(\Delta\)</span>,
we get the following formulation:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
  \begin{pmatrix} z_{1,t} \\ z_{2,t} \end{pmatrix}
=
  \begin{pmatrix} z_{1,t-1} + z_{2,t-1} \Delta  \\
    z_{2,t-1} -g \sin(z_{1,t-1}) \Delta 
     \end{pmatrix}
+q_{t} 
\end{align*}\]</div>
<p>where <span class="math notranslate nohighlight">\(q_t \sim N(0,Q)\)</span>, and</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
Q = q^c
\begin{pmatrix}
  \frac{\Delta^3}{3} &amp;   \frac{\Delta^2}{2} \\
  \frac{\Delta^2}{2} &amp; \Delta 
  \end{pmatrix} 
\end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(q^c\)</span> is the spectral density
of the continuous-time noise process.</p>
<p>We assume the observation model is</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
y_t &amp;= h(z_t) + r_t \\
h(z_t) &amp;=  \sin(\alpha_t)  = \sin(z_{t,1}) \\
r_t &amp;\sim N(0,R)
\end{align*}\]</div>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dynamax</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;installing dynamax&#39;</span><span class="p">)</span>
    <span class="o">%</span><span class="k">pip</span> install -q dynamax[notebooks]
    <span class="kn">import</span> <span class="nn">dynamax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">jax.random</span> <span class="k">as</span> <span class="nn">jr</span>
<span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="kn">from</span> <span class="nn">jaxtyping</span> <span class="kn">import</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Array</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">NamedTuple</span>

<span class="kn">from</span> <span class="nn">dynamax.nonlinear_gaussian_ssm</span> <span class="kn">import</span> <span class="n">ParamsNLGSSM</span><span class="p">,</span> <span class="n">UKFHyperParams</span>
<span class="kn">from</span> <span class="nn">dynamax.nonlinear_gaussian_ssm</span> <span class="kn">import</span> <span class="n">extended_kalman_smoother</span><span class="p">,</span> <span class="n">unscented_kalman_smoother</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:jax._src.lib.xla_bridge:No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For pretty print of ndarrays</span>
<span class="n">jnp</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;float_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sample-data-and-plot-it">
<h2>Sample data and plot it<a class="headerlink" href="#sample-data-and-plot-it" title="Permalink to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some parameters</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0125</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">9.8</span>
<span class="n">q_c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="c1"># Lightweight container for pendulum parameters</span>
<span class="k">class</span> <span class="nc">PendulumParams</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">initial_state</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot;state_dim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">dynamics_function</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span><span class="p">])</span>
    <span class="n">dynamics_covariance</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot;state_dim state_dim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">q_c</span> <span class="o">*</span> <span class="n">dt</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">q_c</span> <span class="o">*</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">q_c</span> <span class="o">*</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">q_c</span> <span class="o">*</span> <span class="n">dt</span><span class="p">]])</span>
    <span class="n">emission_function</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
    <span class="n">emission_covariance</span><span class="p">:</span> <span class="n">Float</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="s2">&quot;emission_dim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pendulum simulation (Särkkä Example 3.7)</span>
<span class="k">def</span> <span class="nf">simulate_pendulum</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">PendulumParams</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="c1"># Unpack parameters</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">initial_state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="o">.</span><span class="n">emission_covariance</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">dynamics_function</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">emission_function</span>
    <span class="n">Q</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">dynamics_covariance</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">emission_covariance</span>

    <span class="k">def</span> <span class="nf">_step</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">rng</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">carry</span>
        <span class="n">rng1</span><span class="p">,</span> <span class="n">rng2</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">next_state</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="n">jr</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">rng1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">Q</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">h</span><span class="p">(</span><span class="n">next_state</span><span class="p">)</span> <span class="o">+</span> <span class="n">jr</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">rng2</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">R</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">next_state</span><span class="p">,</span> <span class="p">(</span><span class="n">next_state</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

    <span class="n">rngs</span> <span class="o">=</span> <span class="n">jr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">observations</span><span class="p">)</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">_step</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">rngs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">states</span><span class="p">,</span> <span class="n">observations</span>


<span class="n">states</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">simulate_pendulum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">x_tr</span><span class="p">,</span> <span class="n">x_obs</span><span class="p">,</span> <span class="n">x_est</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">x_tr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True Angle&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">x_obs</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measurements&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_est</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">x_est</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">est_type</span><span class="si">}</span><span class="s2"> Estimate&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time $t$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Pendulum angle $x_{1,k}$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create time grid for plotting</span>
<span class="n">time_grid</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

<span class="c1"># Plot the generated data</span>
<span class="n">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f1c374bf347e06aa7419488bd9db5ab826b095c3079b780537b12e59b57a5c9f.png" src="../../_images/f1c374bf347e06aa7419488bd9db5ab826b095c3079b780537b12e59b57a5c9f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute RMSE</span>
<span class="k">def</span> <span class="nf">compute_rmse</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_est</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_est</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>


<span class="c1"># Compute RMSE of estimate and print comparison with</span>
<span class="c1"># standard deviation of measurement noise</span>
<span class="k">def</span> <span class="nf">compute_and_print_rmse_comparison</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_est</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">rmse_est</span> <span class="o">=</span> <span class="n">compute_rmse</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_est</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;The RMSE of the </span><span class="si">{</span><span class="n">est_type</span><span class="si">}</span><span class="s2"> estimate is&quot;</span><span class="si">:</span><span class="s1">&lt;40</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">rmse_est</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;The std of measurement noise is&quot;</span><span class="si">:</span><span class="s1">&lt;40</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extended-kalman-filter-smoother">
<h2>Extended Kalman Filter  / smoother<a class="headerlink" href="#extended-kalman-filter-smoother" title="Permalink to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pendulum_params</span> <span class="o">=</span> <span class="n">PendulumParams</span><span class="p">()</span>

<span class="c1"># Define parameters for EKF</span>
<span class="n">ekf_params</span> <span class="o">=</span> <span class="n">ParamsNLGSSM</span><span class="p">(</span>
    <span class="n">initial_mean</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">initial_state</span><span class="p">,</span>
    <span class="n">initial_covariance</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">dynamics_function</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">dynamics_function</span><span class="p">,</span>
    <span class="n">dynamics_covariance</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">dynamics_covariance</span><span class="p">,</span>
    <span class="n">emission_function</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">emission_function</span><span class="p">,</span>
    <span class="n">emission_covariance</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">emission_covariance</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ekf_posterior</span> <span class="o">=</span> <span class="n">extended_kalman_smoother</span><span class="p">(</span><span class="n">ekf_params</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_ekf</span> <span class="o">=</span> <span class="n">ekf_posterior</span><span class="o">.</span><span class="n">filtered_means</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">obs</span><span class="p">,</span> <span class="n">x_est</span><span class="o">=</span><span class="n">m_ekf</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;EKF&quot;</span><span class="p">)</span>
<span class="n">compute_and_print_rmse_comparison</span><span class="p">(</span><span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_ekf</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;EKF&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/eaef2e10f55ccf4c29c15ccc15b0023ddee201364b777e22de141a5ea764e25a.png" src="../../_images/eaef2e10f55ccf4c29c15ccc15b0023ddee201364b777e22de141a5ea764e25a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the EKF estimate is         : 0.14
The std of measurement noise is         : 0.55
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_ekf</span> <span class="o">=</span> <span class="n">ekf_posterior</span><span class="o">.</span><span class="n">smoothed_means</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">obs</span><span class="p">,</span> <span class="n">x_est</span><span class="o">=</span><span class="n">m_ekf</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;EKS&quot;</span><span class="p">)</span>
<span class="n">compute_and_print_rmse_comparison</span><span class="p">(</span><span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_ekf</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;EKS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4303187fa9b027613f46ff8217bff2ba9da801a4dfc157eebddb9adb8b2415e4.png" src="../../_images/4303187fa9b027613f46ff8217bff2ba9da801a4dfc157eebddb9adb8b2415e4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the EKS estimate is         : 0.09
The std of measurement noise is         : 0.55
</pre></div>
</div>
</div>
</div>
</section>
<section id="unscented-kalman-filter-smoother">
<h2>Unscented Kalman Filter  / smoother<a class="headerlink" href="#unscented-kalman-filter-smoother" title="Permalink to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pendulum_params</span> <span class="o">=</span> <span class="n">PendulumParams</span><span class="p">()</span>

<span class="n">ukf_params</span> <span class="o">=</span> <span class="n">ParamsNLGSSM</span><span class="p">(</span>
    <span class="n">initial_mean</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">initial_state</span><span class="p">,</span>
    <span class="n">initial_covariance</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">dynamics_function</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">dynamics_function</span><span class="p">,</span>
    <span class="n">dynamics_covariance</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">dynamics_covariance</span><span class="p">,</span>
    <span class="n">emission_function</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">emission_function</span><span class="p">,</span>
    <span class="n">emission_covariance</span><span class="o">=</span><span class="n">pendulum_params</span><span class="o">.</span><span class="n">emission_covariance</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ukf_hyperparams</span> <span class="o">=</span> <span class="n">UKFHyperParams</span><span class="p">()</span> <span class="c1"># default gives same results as EKF</span>


<span class="n">ukf_posterior</span> <span class="o">=</span> <span class="n">unscented_kalman_smoother</span><span class="p">(</span><span class="n">ukf_params</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">ukf_hyperparams</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_ukf</span> <span class="o">=</span> <span class="n">ukf_posterior</span><span class="o">.</span><span class="n">filtered_means</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">obs</span><span class="p">,</span> <span class="n">x_est</span><span class="o">=</span><span class="n">m_ukf</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;UKF&quot;</span><span class="p">)</span>
<span class="n">compute_and_print_rmse_comparison</span><span class="p">(</span><span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_ukf</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;UKF&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e5c2275d8698d1af739e5fa30ba6e40770f85bf2415743b5a17c693a30c542c2.png" src="../../_images/e5c2275d8698d1af739e5fa30ba6e40770f85bf2415743b5a17c693a30c542c2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the UKF estimate is         : 0.14
The std of measurement noise is         : 0.55
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_uks</span> <span class="o">=</span> <span class="n">ukf_posterior</span><span class="o">.</span><span class="n">smoothed_means</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">obs</span><span class="p">,</span> <span class="n">x_est</span><span class="o">=</span><span class="n">m_uks</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;UKS&quot;</span><span class="p">)</span>
<span class="n">compute_and_print_rmse_comparison</span><span class="p">(</span><span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_uks</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;UKS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4dae15eb77a6159f6429ecb001fecae1c765037aa9267350ec6b944ae5b25ce4.png" src="../../_images/4dae15eb77a6159f6429ecb001fecae1c765037aa9267350ec6b944ae5b25ce4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the UKS estimate is         : 0.09
The std of measurement noise is         : 0.55
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s see how sensitive UKF is to hyper-params</span>

<span class="n">ukf_hyperparams</span> <span class="o">=</span> <span class="n">UKFHyperParams</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">ukf_posterior</span> <span class="o">=</span> <span class="n">unscented_kalman_smoother</span><span class="p">(</span><span class="n">ukf_params</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">ukf_hyperparams</span><span class="p">)</span>

<span class="n">m_ukf</span> <span class="o">=</span> <span class="n">ukf_posterior</span><span class="o">.</span><span class="n">filtered_means</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot_pendulum</span><span class="p">(</span><span class="n">time_grid</span><span class="p">,</span> <span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">obs</span><span class="p">,</span> <span class="n">x_est</span><span class="o">=</span><span class="n">m_ukf</span><span class="p">,</span> <span class="n">est_type</span><span class="o">=</span><span class="s2">&quot;UKF&quot;</span><span class="p">)</span>
<span class="n">compute_and_print_rmse_comparison</span><span class="p">(</span><span class="n">states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_ukf</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;UKF&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/894bcd88a98261b88cab18eb1ec5ff9defd8125293eb6cff7ecd005226eace8d.png" src="../../_images/894bcd88a98261b88cab18eb1ec5ff9defd8125293eb6cff7ecd005226eace8d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The RMSE of the UKF estimate is         : 1.07
The std of measurement noise is         : 0.55
</pre></div>
</div>
</div>
</div>
</section>
</section>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="ekf_ukf_spiral.html" title="previous page">Tracking a spiraling object using the extended / unscented Kalman filter</a>
    <a class='right-next' id="next-link" href="ekf_mlp.html" title="next page">Online learning for an MLP using extended Kalman filtering</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Peter Chang, Giles Harper-Donnelly, Aleyna Kara, Xinglong Li, Scott Linderman, and Kevin Murphy<br/>
        
            &copy; Copyright 2022, Peter Chang, Giles Harper-Donnelly, Aleyna Kara, Xinglong Li, Scott Linderman, and Kevin Murphy.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>